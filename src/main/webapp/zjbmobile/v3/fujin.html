<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <link rel="stylesheet" type="text/css" href="./css/api.css" />
    <link rel="stylesheet" type="text/css" href="./css/common.css" />
		<link rel="stylesheet" type="text/css" href="../css/houses.css" />
		<title></title>
		<script type="text/javascript" src="../script/jquery.js"></script>
		<script type="text/javascript" src="../script/buildHtml.js"></script>
		<script type="text/javascript" src="../script/common.js"></script>
	</head>
	<body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript">
	var currentPage=1;
	var lat,
		lon,
		wrap,
        wrapPos;
	function loadData(clear){
		var url='http://'+server_host+'/c/mobile/nearby.asp?longitude='+lon+'&latitude='+lat;
		YW.ajax({
				url: url,
				method:'post',
				cache:false,
				returnAll:false
			},function(ret , err){
				if(ret){
					if(ret.result.length==0){
						$('#noResultMsg').css('display','block');
					}else{
						$('#noResultMsg').css('display','none');
					}
					if(clear){
						buildHtmlWithJsonArray('repeat',ret.result , false,false);
					}else{
						buildHtmlWithJsonArray('repeat',ret.result , false,true);
					}
					api.parseTapmode();
				}else{
				}
			});
	}
	
	function SeeThis(area){
        api.openWin({
            name: 'view',
            pageParam: {area: area,pageName: 'view',title:area},
			url: '../html/wrap.html',
            bgColor: '#fff'
        });
		$('#'+area).css('color','#999');
	}
	
		apiready = function(){
			
	        wrap = $api.byId('wrap');
	        $api.fixIos7Bar(wrap); 
	        wrapPos = $api.offset(wrap);
			api.setRefreshHeaderInfo(function(ret,err){
				api.refreshHeaderLoadDone();
				currentPage=1;
		    	loadData(true);
//				window.location.reload();
			});
			

		
		var baiduLocation = api.require('baiduLocation');
	    baiduLocation.getLocation(
	        function (ret, err) {
	            var sta = ret.status;
	            lat = ret.latitude;
	            lon = ret.longitude;
	            var t = ret.timestamp;
	
	            if (sta) {
	               // var curUserInfo = CurUserInfo.GetCurUserInfo();
	                var str = '经度：' + lon + '<br>';
	                str += '纬度：' + lat + '<br>';
	                str += '更新时间：' + t + '<br>';
	                loadData();
	            } else {
	                
	            }
	        }
	    );
    
		};
		
	</script>
		<div style="width:98%;margin-left:2%;">
		<div id="noResultMsg" style="text-align:center;display:none">没有符合条件的记录</div>
		<div class="row repeat" style="display:none">
			<p id="$[name]" class="area">$[name]</p>
			<p class="info">
				<span>共有$[total]套房源</span>
			</p>
			<div class="detail" tapmode="tapped" onclick="SeeThis('$[name]')"><img class="icon" src="../image/house_detail.png"/> <span>查看</span></div>
		</div>
		</div>
		
	</body>
</html>
