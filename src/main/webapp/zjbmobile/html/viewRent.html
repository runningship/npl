<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<link rel="stylesheet" type="text/css" href="../css/houses.css" />
		<link rel="stylesheet" type="text/css" href="../css//view.css" />
		<title></title>
		<script type="text/javascript" src="../script/jquery.js"></script>
		
		<script type="text/javascript" src="../script/buildHtml.js"></script>
		<script type="text/javascript" src="../script/common.js"></script>
	</head>
	<body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript">
	var currentPage=1;
	var name;
	var totalPageCount;
	var fufei;
	function loadData(clear){
//	alert(area);
		YW.ajax({
				url:'http://'+server_host+'/c/mobile/rent/list?specArea='+area+'&page='+currentPage,
				method:'post',
				cache:false,
				returnAll:false
			},function(ret , err){
				if(ret){
					totalPageCount = ret.page.totalPageCount;
					if(ret.page.data.length==0){
						$('#noResultMsg').css('display','block');
					}else{
						$('#noResultMsg').css('display','none');
					}
					if(clear){
						buildHtmlWithJsonArray('repeat',ret.page.data , false,false);
					}else{
						buildHtmlWithJsonArray('repeat',ret.page.data , false,true);
					}
					api.parseTapmode(); 
				}else{
				}
			});
	}
	
	function SeeThis(id){
		if(fufei){
//			api.openWin({
//		        name: 'infoJJR',
//		        pageParam: {pageName: 'infoJJR',title:'详情' , id:id},
//				url: 'wrap.html',
//		        bgColor: '#fff'
//		    });
		    
			api.openWin({
			    name: 'infoRentJJR',
			    bounces: false,
			    pageParam: {id: id},
				url: 'infoRentJJR.html'
			});
		}else{
			api.openWin({
		        name: 'infoRent',
		        pageParam: {pageName: 'infoRent',title:'详情' , id:id},
				url: 'wrap.html',
		        bgColor: '#fff'
		    });
//			api.openWin({
//			    name: 'info',
//			    bounces: false,
//			    pageParam: {id: id},
//				url: 'info.html'
//			});
		}
		$('#'+id).css('color','#999');
     }
	
		apiready = function(){
			getUserInfo(function(user){
				if(user){
					fufei = user.fufei;
				}
				
			});
			api.setRefreshHeaderInfo(function(ret,err){
			    api.refreshHeaderLoadDone();
			    currentPage=1;
		    	loadData(true);
//				window.location.reload();
			});
			
			api. addEventListener({name:'scrolltobottom'}, 
				function(ret, err){
					//设置提示信息
					if(currentPage<totalPageCount){
						currentPage++;
					}else{
						alert('已是最后一页');
						return;
					}
					loadData();
				}
			);
			area = api.pageParam.area;
			loadData();
		};
		
		function closexx(){
			api.closeWin({
			    name: 'view'
		    });
		}
function isFufei(){
	return fufei;
}

function getRentType(code){
	if(code=='1'){
		return '整租';
	}else if(code=='2'){
		return '合租';
	}else{
		return code;
	}
}
	</script>
		
		<div class="wrap">
		<div id="noResultMsg" style="text-align:center;display:none">没有符合条件的记录</div>
			<div class="row repeat" style="display:none">
				<div tapmode="tapped" onclick="SeeThis('$[id]');return false;" style="height:45px;padding-top:1px;">
				<p id="$[id]" class="area">$[area] <span show="isFufei();">&nbsp;&nbsp;$[dhao]-$[fhao]</span></p>
				<div class="info">
					<div>$[quyu]</div><div>$[mji]㎡</div><div>$[zjia]元</div><div runscript="true">getRentType('$[fangshi]')</div>
				</div>
				<div class="detail" tapmode="tapped" ><img class="icon" src="../image/house_detail.png"/> <span>详情</span></div>
				</div>
			</div>
		</div>
		
	</body>
</html>
