<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<link rel="stylesheet" type="text/css" href="../css/houses.css" />
<link rel="stylesheet" type="text/css" href="../css/fav.css" />
		<!--<link rel="stylesheet" type="text/css" href="../css/box.css" />-->
<title></title>
<script type="text/javascript" src="./script/api.js"></script>
<script type="text/javascript" src="../script/jquery.js"></script>
<script type="text/javascript" src="../script/buildHtml.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
var set=0;
var Ids=[];
var userId;
var selectAll=0;
var checkbox;
var currentPage=1;
var totalPageCount;
var totalCount;
var fufei;
function loadData(){
	//PService
	YW.ajax({
			url:'http://'+server_host+'/c/mobile/user/tracksRent?userId='+userId+'&currentPageNo='+currentPage,
			method:'post',
			cache:false,
			returnAll:false
		},function(ret , err){
			if(ret){
				totalCount = ret.page.totalCount;
				if(ret.page.totalCount==0){
					$('#nonedata').css('display','')
				}else{
					totalPageCount = ret.page.totalPageCount;
					buildHtmlWithJsonArray('repeat',ret.page.data , false,true);
					api.parseTapmode();
				}
			}else{
			}
		});
}
	
function closexx(){
	api.closeWin({
	    name: 'tracks'
    });
}

function setDelete(){
	$('.ids').toggleClass('hide');
	
}

function AddDelete(id,obj){
	if(obj.checked){
		Ids.push(id);
	}else{
	    for(var i=0;i<Ids.length ;i++){
	      if (Ids[i]==id) {
	        Ids.splice(i,1);
	      };
	    }
	}
}

 function selectAllItems(){
 	checkbox=$('input[type=checkbox]');
	 if(selectAll==0){
	 	checkbox.prop('checked',true);
	 	$('#selectA').html('全不选');
    	checkbox.each(function(i){ 
	      if ($(this).val()!='$[id]') {
	        Ids[i-1] = $(this).val(); 
	      }
	 	selectAll=1;
	 	});
	 }else{
	 	$('#selectA').html('全选');
	 	checkbox.prop('checked',false);
	 	Ids=[];
	 	selectAll=0;
	 }
 }

function delItems(){
 	checkbox=$('input[type=checkbox]');
	checkbox.each(function(i){
	      if ($(this).val()!='$[id]') {
		$('#'+$(this).val()+'').remove();
	      }
	return;
	});
	YW.ajax({
			url:'http://'+server_host+'/c/mobile/user/deltracks?chuzu=1&hid='+Ids+'&userId='+userId,
			method:'post',
			cache:false,
			returnAll:false
		},function(ret , err){
			if(ret){
				currentPage=1;
				loadData();
		        alert('该记录已删除');
		        Ids = [];
		        //不要刷新页面
		        //remove checked box
			}else{
			}
		});
}

	function SeeThis(id){
//		api.openWin({
//		    name: 'infoJJR',
//		    bounces: false,
//		    pageParam: {id: id},
//			url: 'infoJJR.html'
//		});

		if(fufei){
		    
			api.openWin({
			    name: 'infoRentJJR',
			    pageParam: {id: id},
			    delay:300,
				url: 'infoRentJJR.html'
			});
		}else{
			api.openWin({
		        name: 'infoRent',
		        pageParam: {pageName: 'infoRent',title:'详情' , id:id},
				url: 'wrap.html',
				delay:300,
		        bgColor: '#fff'
		    });
		}

		$('#id_'+id).css('color','#999');
     }
     
function isFufei(){
	return fufei;
}

apiready=function(){
			
			api. addEventListener({name:'scrolltobottom'}, 
				function(ret, err){
					//设置提示信息
					if(currentPage<totalPageCount){
						currentPage++;
					}else{
						alert('已是最后一页');
						return;
					}
					loadData();
				}
			);
	getUserInfo(function(user){
		fufei = user.fufei;
		userId=user.uid;
	    loadData();
	});
};

function getRentType(code){
	if(code=='1'){
		return '整租';
	}else if(code=='2'){
		return '合租';
	}else{
		return code;
	}
}
</script>
</head>
<body>




<div class="body">
	<div class="wrap">
		<div style="text-align:center;display:none" id="nonedata">没有符合条件的记录</div>
		<div class="row repeat" style="display:none" id="$[id]">
			<div style="float:left;" class="ids hide">
				<input type="checkbox" class="checkbox" onclick="AddDelete('$[id]',this)" name="ids" value="$[id]">
			</div>
			<div>
				<p id="id_$[id]" class="area"><span>$[area]</span><span show="isFufei();">&nbsp;&nbsp;$[dhao]-$[fhao]</span></p>
				<p class="info2">
					<span>$[quyu]</span><span>$[mji]㎡</span><span>$[zjia]元</span><span runscript="true">getRentType('$[fangshi]')</span>
				</p>
				<div tapmode="tapped"  class="detail" onclick="SeeThis('$[id]');return false;"><img class="icon" src="../image/house_detail.png"/> <span>详情</span></div>
			</div>
		</div>
	</div>
</div>
</body>
</html>
