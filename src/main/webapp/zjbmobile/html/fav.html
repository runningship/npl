<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<link rel="stylesheet" type="text/css" href="../css/houses.css" />
<link rel="stylesheet" type="text/css" href="../css/fav.css" />
<title></title>
<!--<script type="text/javascript" src="./script/api.js"></script>-->
<script type="text/javascript" src="../script/jquery.js"></script>
<script type="text/javascript" src="../script/buildHtml.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
var set=0;
var selectAll=0;
var Ids=[];
var userId;
var checkbox;
var currentPage=1;
var totalPageCount;
var totalCount;
var fufei;
function loadData(){
	YW.ajax({
			url:'http://'+server_host+'/c/mobile/fav/list?userId='+userId+'&currentPageNo='+currentPage,
			method:'post',
			cache:false,
			returnAll:false
		},function(ret , err){
			if(ret){
				totalCount = ret.page.totalCount;
				if(ret.page.totalCount==0){
					$('#nonedata').css('display','')
				}else{
					totalPageCount = ret.page.totalPageCount;
					buildHtmlWithJsonArray('repeat',ret.page.data , false,true);
					api.parseTapmode();
				}
			}else{
			}
		});
}
	
function closexx(){
	api.closeWin({
	    name: 'fav'
    });
}

function setDelete(){
	$('.ids').toggleClass('hide');
//	if(set==0){
//		$('.ids').css('display','');
//		$('.selectA').css('display','');
//		set=1;
//	}else{
//	 	selectAll=1;
//	 	SelectAll();
//		$('.ids').css('display','none');
//		$('.selectA').css('display','none');
//		set=0;
//	}
}

function AddDelete(id,obj){
	if(obj.checked){
		Ids.push(id);
	}else{
	    for(var i=0;i<Ids.length ;i++){
	      if (Ids[i]==id) {
	        Ids.splice(i,1);
	      };
	    }
	}
}

 function selectAllItems(){
 	checkbox=$('input[type=checkbox]');
	 if(selectAll==0){
	 	checkbox.prop('checked',true);
    	checkbox.each(function(i){ 
	      if ($(this).val()!='$[id]') {
	        Ids[i-1] = $(this).val(); 
	      }
	 	selectAll=1;
	 	});
	 }else{
	 	checkbox.prop('checked',false);
	 	Ids=[];
	 	selectAll=0;
	 }
 }
     
function delItems(){
 	checkbox=$('input[type=checkbox]');
	checkbox.each(function(i){
	      if ($(this).val()!='$[id]') {
		$('#'+$(this).val()+'').remove();
	      }
	return;
	});
	YW.ajax({
			url:'http://'+server_host+'/c/mobile/fav/trigger?houseId='+Ids+'&userId='+userId,
			method:'post',
			cache:false,
			returnAll:false
		},function(ret , err){
			if(ret){
				currentPage=1;
				loadData();
				alert('该收藏已取消');
		        Ids = [];
			}else{
			}
	});
}

function isFufei(){
	return fufei;
}

function SeeThis(id){
//	api.openWin({
//	    name: 'infoJJR',
//	    bounces: false,
//	    pageParam: {id: id},
//		url: 'infoJJR.html'
//	});

		if(fufei){
		    
			api.openWin({
			    name: 'infoJJR',
			    pageParam: {id: id},
			    delay:300,
				url: 'infoJJR.html'
			});
		}else{
			api.openWin({
		        name: 'info',
		        pageParam: {pageName: 'info',title:'详情' , id:id},
				url: 'wrap.html',
				delay:300,
		        bgColor: '#fff'
		    });
		}
		$('#id_'+id).css('color','#999');
 }
 
apiready=function(){
	
	api. addEventListener({name:'scrolltobottom'}, 
		function(ret, err){
			//设置提示信息
			if(currentPage<totalPageCount){
				currentPage++;
			}else{
				alert('已是最后一页');
				return;
			}
			loadData();
		}
	);
	getUserInfo(function(user){
		fufei=user.fufei;
		userId=user.uid;
	    loadData();
	});
};
</script>
</head>
<body>
<div class="body">
	<div class="wrap">
		<div style="text-align:center;display:none" id="nonedata">没有符合条件的记录</div>
		<div class="row repeat" style="display:none" id="$[id]">
			<div style="float:left;" class="ids hide">
				<input type="checkbox" style="margin-top:8px;" class="checkbox" onclick="AddDelete('$[id]',this)" name="ids" value="$[id]">
			</div>
			<div>
				<p id="id_$[id]" class="area"><span>$[area]</span><span show="isFufei();">&nbsp;&nbsp;$[dhao]-$[fhao]</span></p>
				<p class="info2">
					<span>$[quyu]</span><span>$[mji]㎡</span><span>$[zjia]万</span><span>$[lceng]层</span>
				</p>
				<div tapmode="tapped" class="detail" onclick="SeeThis('$[id]');return false;"><img class="icon" src="../image/house_detail.png"/> <span>详情</span></div>
			</div>
		</div>
	</div>
</div>
</body>
</html>
