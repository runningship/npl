<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<link rel="stylesheet" type="text/css" href="../css/houses.css" />
		<title></title>
		<script type="text/javascript" src="../script/jquery.js"></script>
		
		<script type="text/javascript" src="../script/buildHtml.js"></script>
		<script type="text/javascript" src="../script/common.js?2"></script>
		
	</head>
	<body style="background:white">
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript">
	var currentPage=1;
	var totalPageCount;
	var fufei;
	function loadData(clear){
		YW.ajax({
		//http://mobile.zjb.tunnel.mobi/c/mobile/list
			url:'http://'+server_host+'/c/mobile/list?page='+currentPage,
			method:'post',
			cache:false,
			returnAll:false
		},function(ret , err){
			if(ret){
				totalPageCount = ret.page.totalPageCount;
					if(ret.page.data.length==0){
						$('#noResultMsg').css('display','block');
					}else{
						$('#noResultMsg').css('display','none');
					}
				if(clear){
					buildHtmlWithJsonArray('repeat',ret.page.data , false,false);
				}else{
					buildHtmlWithJsonArray('repeat',ret.page.data , false,true);
				}
				
				api.parseTapmode();
			}else{
			}
		});
	}
	
	function SeeThis(id){
		if(fufei){
//			api.openWin({
//		        name: 'infoJJR',
//		        pageParam: {pageName: 'infoJJR',title:'详情' , id:id},
//				url: 'index.html',
//		        bgColor: '#fff'
//		    });
		    
			api.openWin({
			    name: 'infoJJR',
			    pageParam: {id: id},
			    delay:300,
				url: 'infoJJR.html'
			});
		}else{
			api.openWin({
		        name: 'info',
		        pageParam: {pageName: 'info',title:'详情' , id:id},
				url: 'wrap.html',
				delay:300,
		        bgColor: '#fff'
		    });
//			api.openWin({
//			    name: 'info',
//			    pageParam: {id: id},
//				url: 'info.html'
//			});
		}
		$('#'+id).css('color','#999');
//		$('#img_'+id).css('-webkit-filter','grayscale(1)');
     }
	
		apiready = function(){
			getUserInfo(function(user){
				if(user){
					fufei = user.fufei;
				}
			});
			api.setRefreshHeaderInfo({
				loadingImg: 'widget://image/loading.jpg'
				//bgColor:'white'
				},
				function(ret,err){
		    	api.refreshHeaderLoadDone();
		    	buildHtmlWithJsonArray('repeat',[] , false,false);
		    	currentPage=1;
		    	loadData(true);
				//window.location.reload();
			});
			
			api. addEventListener({name:'scrolltobottom'}, 
				function(ret, err){
					//设置提示信息
					if(currentPage<totalPageCount){
						currentPage++;
					}else{
						alert('已是最后一页');
						return;
					}
					setTimeout(loadData,100);
				}
			);
			
			loadData();
		};

function isFufei(){
	return fufei;
}

function refreshPage(){
	window.location.reload();
}
	</script>
		<div style="width:98%;margin-left:2%;">
		<div id="noResultMsg" style="text-align:center;display:none">没有符合条件的记录</div>
		<div  class="row repeat" style="display:none">
			<p id="$[id]" class="area">$[area] <span show="isFufei();">&nbsp;&nbsp;$[dhao]-$[fhao]</span></p>
			<div class="info">
				<div>$[quyu]</div><div>$[mji]㎡</div><div>$[zjia]万</div><div>$[lceng]层</div>
			</div>
			<div  class="detail" tapmode="tapped" onclick="SeeThis('$[id]');return false;">
			<img class="icon" id="img_$[id]" src="../image/house_detail.png"/> 
			<span >详情</span></div>
		</div>
		
		</div>
	</body>
</html>
