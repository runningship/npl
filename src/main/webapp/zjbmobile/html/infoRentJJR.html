<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
				<link href="../v3/css/reset.css" rel="stylesheet">
	<link href="../v3/css/style.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../css/info.css" />
	<link rel="stylesheet" type="text/css" href="../css/box.css" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />
		<title></title>
		<script type="text/javascript" src="../script/jquery.js"></script>
		
		<script type="text/javascript" src="../script/buildHtml.js"></script>
		<script type="text/javascript" src="../script/common.js"></script>
	</head>
	<body>
	<script type="text/javascript" src="../script/api.js"></script>
	
	<script type="text/javascript">
	var hid;
	var uid;
	var area;
	var fdhao;
	var houseDetail;
	var tels;
	var tel_json = JSON.parse('[]');
	function loadData(){
		YW.ajax({
				url:'http://'+server_host+'/c/mobile/rent/detail?houseId='+hid+'&userId='+uid,
				method:'post',
				cache:false,
				returnAll:false
			},function(ret , err){
				if(ret){
					houseDetail = ret;
					area = ret.area;
					fdhao = ret.dhao+' - '+ret.fhao;
					$('#area').html(ret.area+'  '+fdhao);
					$('#dateadd').html(ret.dateadd);
					$('#quyu').html(ret.quyu);
					$('#ztai').html(ret.ztai);
					if(ret.mji){
						$('#mji').html(ret.mji+'m²');
					}
					if(ret.zjia){
						$('#zjia').html(ret.zjia+'元');
					}
					if(ret.lceng){
						$('#lceng').html(ret.lceng+'层');
					}
					$('#lxing').html(ret.lxing);
					$('#hxing').html(ret.hxf+"室"+ret.hxt+"厅"+ret.hxw+"卫");
					$('#zxiu').html(ret.zxiu);
					if(ret.year){
						$('#year').html(ret.year+'年');
					}
					$('#address').html(ret.address);
					$('#beizhu').html(ret.beizhu);
					$('#lxr').html(ret.lxr);
					tels = ret.tel.split(',');
					    for(var i=0;i<tels.length ;i++){
							var xx = JSON.parse('{}');
							if(tels[i].trim()==''){
								continue;
							}
					    	xx.tel = tels[i];
					    	tel_json.push(xx);
					    }
					    if(ret.telImg && !ret.tel){
					    	$('#telImg').css('display','');
					    	$('#telImg img').attr("src",ret.telImg);
					    }
					buildHtmlWithJsonArray('tel_repeat',tel_json , false,true);
					api.parseTapmode();
					if(ret.isfav=='1'){
						$('#fav').attr('src','../image/fav-yes.png');
					}
				}else{
				}
			});
	}
	
	function loadGenJin(){
		YW.ajax({
				url:'http://'+server_host+'/c/mobile/house/genjin/list?houseId='+hid,
				method:'post',
				cache:false,
				returnAll:false
			},function(ret , err){
				if(ret){
					buildHtmlWithJsonArray('genjin',ret.data , false,true);
				}else{
				}
			});
	}
	apiready = function(){
		getUserInfo(function(user){
			uid=user.uid;
			hid = api.pageParam.id;
			loadData();
			loadGenJin()
		});
		
	};
	
	function closexx(){
		api.closeWin({
		    name: 'infoRentJJR'
	    });
	}
	
	function reloadPage(){
		window.location.reload();
	}
	
	function triggerFav(){
		YW.ajax({
			url:'http://'+server_host+'/c/mobile/fav/triggerRent?houseId='+hid+'&userId='+uid,
			method:'post',
			cache:false,
			returnAll:false
		},function(ret , err){
			if(ret && ret.isfav=='1'){
				//修改收藏状态
				$('#fav').attr('src','../image/fav-yes.png');
				api.toast({
				    msg: '已收藏',
				    duration:2000,
				    location: 'bottom'
				});
			}else{
				$('#fav').attr('src','../image/fav-no.png');
				api.toast({
				    msg: '取消收藏',
				    duration:2000,
				    location: 'bottom'
				});
			}
		});
	}
	
	function call(num){
		num = num.split('-')[0];
		api.call({
		    type: 'tel_prompt',
		    number: num
		});
	}
	
	
	function openGenJin(){
		api.openWin({
		    name: 'genjinRent',
		    pageParam:{hid:hid,area:area,fdhao:fdhao , pageName:'genjinRent',title:area+fdhao},
			url: 'wrap.html'
		});
	}
	
	function daohang(){
//		alert(houseDetail.latitude+','+houseDetail.longitude);
//		window.location="intent://map/place/search?query=银行&region=北京&referer=yourCompanyName|yourAppName#Intent;scheme=bdapp;package=com.baidu.BaiduMap;end";
			var baiduLocation = api.require('baiduLocation');
		    baiduLocation.getLocation(
		        function (ret, err) {
		            if (ret.status) {
		            	getCityInfo(function(city){
		            		if(houseDetail.latitude && houseDetail.longitude){
		            			window.location='http://api.map.baidu.com/direction?origin=latlng:'+ret.latitude+','+ret.longitude+'|name:我的位置&destination=name:终点|latlng:'+houseDetail.latitude+','+houseDetail.longitude+'&mode=driving&region='+city.name+'&output=html';
		            		}else{
		            			window.location='http://api.map.baidu.com/direction?origin=latlng:'+ret.latitude+','+ret.longitude+'|name:起点&destination='+area+'&mode=driving&region='+city.name+'&output=html';
		            		}
		            	});
		            } else {
		            }
		        }
		    );
		
//		if(houseDetail.latitude && houseDetail.longitude){
//			api.openWin({
//			    name: 'daohang',
//			    pageParam:houseDetail,
//				url: 'nav.html'
//			});
//		}else{
//			alert(houseDetail.id+' 没有经纬度');
//		}
		
	}
	</script>
<div class="body">
<div id="wrap">
	<div class="header" >
		<span class="left">
	            <a onclick="closexx();" class="btns"><i class="iconfont">&#xe628;</i></a>
	        </span>
            <span id="title" class="title conter" style="">出租
            </span>
            <span class="right"><a onclick="closexx();" class="btns"><i class="iconfont"></i></a>
        	</span>
	</div>
	<div class="wrap" style="top:62px;">
		<h1 id="area" ><b></b></h1>
        <p id="dateadd" class="times"></p>
		<table style="width:98%;margin-top:10px;">
			<tr>
				<td class="label">区域: </td><td id="quyu"></td><td class="label">户型: </td><td id="hxing"></td>
			</tr>
			<tr>
				<td class="label">面积: </td><td id="mji"></td><td class="label">租金: </td><td id="zjia"></td>
			</tr>
			<tr>
				<td class="label">楼型: </td><td id="lxing"></td><td class="label">楼层: </td><td id="lceng"></td>
			</tr>
			<tr>
				<td class="label">装潢: </td><td id="zxiu"></td><td class="label">建于: </td><td id="year"></td>
			</tr>
			<tr>
				<td class="label addr">地址: </td><td id="address" colspan="3"></td>
			</tr>
			<tr>
				<td class="label">其他: </td><td id="beizhu" colspan="3"></td>
			</tr>
		</table>
		<table class="fangzhu" style="width:98%">
			<tr>
				<td class="label">房主: </td><td id="lxr" style="  vertical-align: middle;"></td>
			</tr>
			<tr class="tel_repeat" style="display:none;">
				<td class="label">电话: </td><td style="position:relative;vertical-align: middle;">
					<a href="#" tapmode="tapped" onclick="call('$[tel]');">$[tel] </a> <img src="../image/phone2.png" onclick="call('$[tel]');" tapmode="tapped" class="callBtn"/>
					</td>
			</tr>
			<tr id="telImg" style="display:none">
				<td class="label">电话: </td><td><img src=""/></td>
			</tr>
		</table>
		
		<div class="genjinWrap">
			<p style="color:#888;">跟进信息: </p>
			<div class="genjin" style="display:none">
				<p class="conts" style="padding-left:2%">$[conts]</p>
				<div style="text-align:right;font-size:14px;color:#aaa">$[dateadd]</div>
			</div>
		</div>
	</div>
	
    <div id="footer" class="footer">
        <div class="bottom2">
			<!--<div onclick="selectAndCall();" tapmode="tapped" class="item"><img class="icon" src="../image/dianhua.png"/><span>电话</span></div>-->
			<div onclick="openGenJin();" tapmode="tapped" class="item"><img class="icon" src="../image/genjin.png"/><span>跟进</span></div>
			<div tapmode="tapped" onclick="triggerFav();" class="item"><img id="fav"  class="icon" src="../image/fav-no.png"/><span>收藏</span></div>
			<div onclick="daohang();" tapmode="tapped" class="item" style="border-right:none"><img class="icon" src="../image/qianwang.png"/><span>前往</span></div>
		</div>
    </div>
</div>
	</body>
</html>
