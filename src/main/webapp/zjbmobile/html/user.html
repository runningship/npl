<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<link rel="stylesheet" type="text/css" href="../css/user.css" />
<title></title>
<script type="text/javascript" src="../script/jquery.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
var payWay='offline';
apiready=function(){
	getUserInfo(function(user){
		$('#uname').text(user.uname);
		$('#tel').text(user.tel);
		payWay = user.payWay;
		if(api.systemType=='ios' && payWay!='online'){
			$('#bottomIOS').css("display","");
		}else{
			$('#bottomAll').css("display","");
		}
		if(user.lname){
			$('#lname').text(user.lname);
		}
		if(user.cname && user.dname){
			$('#cname').text(user.cname);
			$('#dname').text(user.dname);
		}else{
			$('#compWrap').css('display','none');
			$('.account').css('height','144px');
		}
		
		if(user.mobileDeadtime){
			$('#deadtime').text(user.mobileDeadtime);
		}else{
			$('#deadTimeWrap').css('display','none');
//			$('.account').css('height','144px');
		}
		if(user.fufei){
			$('#deadtime').css('color','blue');
		}else{
			$('#deadtime').text($('#deadtime').text()+'(已过期)');
			$('#deadtime').css('color','red');
		}
//		blockAlert('fewf');
		setTimeout(function(){
			api.closeWin({
				name:'login'
	        });
		},2000);
		
	});
	
	
//	var ajpush = api.require('ajpush');
//	var param = {alias: tel};
//	ajpush.bindAliasAndTags(param,function(ret) {
//	     alert('绑定到'+param.alias);
//	});
}

function updateDeadtime(){
	getUserInfo(function(user){
		$('#deadtime').text(user.mobileDeadtime);
	});
}
function closexx(){
	api.closeToWin({
	    name: 'root'
    });
}

	function SeeThis(type){
        api.openWin({
            name: 'wrap_wode',
            pageParam: {type: type},
			url: 'wrap_wode.html',
            bgColor: '#fff'
        });
     }
	
	function ShareUs(){
        api.openWin({
            name: 'share',
			url: 'share.html',
            bgColor: '#fff'
        });
     }
	
function logout(){
	api.setPrefs({
	    key: 'user',
	    value: ''
	});
	
	YW.ajax({
		url:'http://'+server_host+'/c/mobile/user/logout?tel='+$('#tel').text(),
		method:'post',
		cache:false,
		returnAll:false
	},function(ret , err){
	});
//	api.openWin({
//      name: 'login',
//      pageParam: {pageName: 'login',title:'登录'},
//		url: 'wrap.html',
//      bgColor: '#fff'
//  });
	
	api.execScript({
	    name: 'root',
	    script: 'refreshHouses();'
	});
		
//  setTimeout(function(){
//  	api.closeWin({
//		    name: 'login'
//	    });
//  	
//		api.closeWin({
//		    name: 'user'
//	    });
//	    
//	},1000);

	closexx();
}

function xufei(){
	api.openWin({
        name: 'order',
		url: 'order.html',
        bgColor: '#fff'
    });		
}

function clearCache(){
	api.setPrefs({
	    key:'tel',
	    value:''
    });
    api.setPrefs({
	    key:'pwd',
	    value:''
    });
//	api.setPrefs({
//	    key:'city',
//	    value:''
//  });
//	api.setPrefs({
//	    key:'user',
//	    value:''
//  });
    alert('缓存清理成功');
}

function openPwdWin(){
	api.openWin({
        name: 'pwd',
        pageParam: {pageName: 'pwd',title:'修改密码'},
		url: 'wrap.html',
        bgColor: '#fff'
    });
}

</script>
</head>
<body>
	<!--<div class="header" >
		<img onclick="closexx();" class="back" src="../image/back.png"/><div class="title">我 的</div>
	</div>-->
	
	<div class="account">
		<div class="user">
			<div class="info" style="margin-top:5px;"><span id="uname"></span></div>
			<div class="info tel" id="tel" ></div>
			<div class="info" id="deadTimeWrap" style="margin-top:10px;" ><span class="item" tapmode="tapped" id="deadtime" ></span></div>
		</div>
		<table id="compWrap" class="compWrap">
			<tr  class="dept">
				<td width="49%"><div id="cname"></div></td>
				<td ><span class="sep">|</span></td>
				<td width="49%"><div id="dname"></div></td>
			</tr>
		</table>
	</div>
	
	<table style="width:100%;text-align:center;margin-top:20px;">
		<tr class="my">
			<td width="49%"><div class="menu" tapmode="tapped" onclick="SeeThis('fav');">我的收藏</div></td>
			<td><span class="sep">|</span></td>
			<td width="49%"><div class="menu" tapmode="tapped" onclick="SeeThis('tracks');">我的记录</div></td>
		</tr>
	</table>
	
	<div style="border-bottom:1px solid #ddd;margin-top:30px;"></div>
	<div class="bottom" style="display:none" id="bottomAll">
		<table id="about" style="width:100%;text-align:center;margin-top:20px;">
			<tr>
				<td><div tapmode="tapped" class="item"  onclick="ShareUs();"><img src="../image/share.png"/> <span class="action">推荐我们</span></div></td>
				<td><span class="sep"> </span></td>
				<td><div tapmode="tapped" onclick="clearCache();" class="item"><img src="../image/clear.png" /> <span class="action">清空缓存</span></div></td>
			</tr>
			<tr>
				<td><div tapmode="tapped" onclick="xufei();" class="item"><img src="../image/update.png" /> <span class="action">充值续费</span></div></td>
				<td><span class="sep"> </span></td>
				<td><div tapmode="tapped" onclick="openPwdWin();" class="item"><img src="../image/lock.png" /> <span class="action">修改密码</span></div></td>
			</tr>
		</table>
	</div>
	<div class="bottom" style="display:none" id="bottomIOS">
		<table id="about" style="width:100%;text-align:center;margin-top:20px;">
			<tr>
				<td><div tapmode="tapped" class="item"  onclick="ShareUs();"><img src="../image/share.png"/> <span class="action">推荐我们</span></div></td>
				<td><span class="sep"> </span></td>
				<td><div tapmode="tapped" onclick="openPwdWin();" class="item"><img src="../image/lock.png" /> <span class="action">修改密码</span></div></td>
			</tr>
		</table>
	</div>
	<div>
		<div tapmode="tapped" class="quit" onclick="logout();">退出登录</div>
	</div>
</body>
</html>
