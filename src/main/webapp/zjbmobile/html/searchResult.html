<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<link rel="stylesheet" type="text/css" href="../css/houses.css" />
		<!--<link rel="stylesheet" type="text/css" href="../css/searchResult.css" />-->
		<title></title>
		<script type="text/javascript" src="../script/jquery.js"></script>
		
		<script type="text/javascript" src="../script/buildHtml.js"></script>
		<script type="text/javascript" src="../script/common.js"></script>
	</head>
	<body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript">
	var currentPage=1;
	var params;
	var totalPageCount;
	var fufei;
	function loadData(clear){
		YW.ajax({
				url:'http://'+server_host+'/c/mobile/list?page='+currentPage,
				method:'post',
				cache:false,
				data:{values:params},
				returnAll:false
			},function(ret , err){
				if(ret){
					totalPageCount = ret.page.totalPageCount;
					if(ret.page.data.length==0){
						$('#noResultMsg').css('display','block');
					}else{
						$('#noResultMsg').css('display','none');
					}
					if(clear){
						buildHtmlWithJsonArray('repeat',ret.page.data , false,false);
					}else{
						buildHtmlWithJsonArray('repeat',ret.page.data , false,true);
					}
					api.parseTapmode();
				}else{
				}
			});
	}
	
		apiready = function(){
			params = api.pageParam;
			getUserInfo(function(user){
				if(user){
					fufei = user.fufei;
				}
				
			});
			api.setRefreshHeaderInfo(function(ret,err){
			    api.refreshHeaderLoadDone();
			    currentPage=1;
		    	loadData(true);
//				window.location.reload();
			});
			
			api. addEventListener({name:'scrolltobottom'}, 
				function(ret, err){
					//设置提示信息
					if(currentPage<totalPageCount){
						currentPage++;
					}else{
						alert('已是最后一页');
						return;
					}
					loadData();
				}
			);
			
			loadData();
		};
		
	function SeeThis(id){
		if(fufei){
//			api.openWin({
//		        name: 'infoJJR',
//		        pageParam: {pageName: 'infoJJR',title:'详情' , id:id},
//				url: 'wrap.html',
//		        bgColor: '#fff'
//		    });
		    
			api.openWin({
			    name: 'infoJJR',
			    pageParam: {id: id},
				url: 'infoJJR.html'
			});
		}else{
			api.openWin({
		        name: 'info',
		        pageParam: {pageName: 'info',title:'出售' , id:id},
				url: 'wrap.html',
		        bgColor: '#fff'
		    });
		    
//			api.openWin({
//			    name: 'info',
//			    pageParam: {id: id},
//				url: 'info.html'
//			});
		}
		$('#'+id).css('color','#999');
     }

function isFufei(){
	return fufei;
}
	</script>
	<div class="wrap" style="height:100%">
		<div style="width:98%;margin-left:1%;height:100%">
		<div id="noResultMsg" style="text-align:center;display:none">没有符合条件的记录</div>
		<div class="row repeat" style="display:none">
			<div tapmode="tapped" onclick="SeeThis('$[id]');return false;" style="height:45px;padding-top:1px;">
			<div id="$[id]" class="area">$[area] <span show="isFufei();">&nbsp;&nbsp;$[dhao]-$[fhao]</span></div>
			<div class="info">
				<div>$[quyu]</div><div>$[mji]㎡</div><div>$[zjia]万</div><div>$[lceng]层</div>
			</div>
			<div class="detail" ><img class="icon" src="../image/house_detail.png"/> <span>详情</span></div>
			</div>
		</div>
		</div>
	</div>
		
	</body>
</html>
